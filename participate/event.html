<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Enter your Event Code</h1>
    <form action="" method="get">
        <input type="text" id="event_code">
        <button type="submit" id="event_deets_btn">Submit</button>
    </form>
    
    <script>
        const eventbtn = document.querySelector("#event_deets_btn");
        const eventCode = document.querySelector("#event_code");
        const body = document.querySelector("body");
        eventbtn.addEventListener("click", (e) => {
            e.preventDefault();
            console.log("clicked")
            var requestOptions = {
                method: 'GET',
                redirect: 'follow'
            };

            fetch("https://mighty-sea-62531.herokuapp.com/api/events/getEvent/" + event_code.value, requestOptions)
                .then(response => {
                    console.log(response)
                    return response.json();
                })
                .then(result => {
                    showActions(result)
                })
                .catch(error => console.log('error', error));
        })
        function showActions(res) {
            actions = res["Actions"];
            var requestOptions = {
                method: 'GET',
                redirect: 'follow'
            };
            actions.forEach((ele) => {
                fetch("https://mighty-sea-62531.herokuapp.com/api/actions/getActiondetail/" + ele, requestOptions)
                    .then(response => {
                        return response.json();
                    })
                    .then(result => {
                        let button = document.createElement("button");
                        button.style.display = "block";
                        button.innerHTML = result["action_type"];
                        body.appendChild(button);
                        if (result["action_type"] == "Quiz") {
                            sessionStorage.setItem("quiz_action_id", ele);
                            window.location.href = "quiz.html";
                        }
                    })
                    .catch(error => console.log('error', error));
            })
        }

    </script>
</body>

</html>